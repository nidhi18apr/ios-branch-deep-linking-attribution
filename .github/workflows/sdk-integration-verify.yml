name: SDK Integration Tests

on: [push]

jobs:
  verify:
    runs-on: macos-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v3
      - name: Verify CocoaPods Integration
        run: |
            echo "$PWD"
            cd  SDKIntegrationTestApps/iOSReleaseTest-Cocoapods/
            pod update
            xcodebuild test -scheme iOSReleaseTest -workspace iOSReleaseTest.xcworkspace -destination 'platform=iOS Simulator,name=iPhone 13,OS=16.0' | xcpretty && exit ${PIPESTATUS[0]}
      - name: Verify Carthage Integration
        env:
            BRANCH_NAME: ${{ github.head_ref || github.ref_name }}
        run: |
            echo "$PWD"
            CURR_DIR=$(PWD)
            cd  SDKIntegrationTestApps/iOSReleaseTest-Carthage/
            echo "git \"file://${CURR_DIR}\" \"$BRANCH_NAME\" " >> cartfile
            carthage update --use-xcframeworks
            xcodebuild test -scheme iOSReleaseTest -workspace iOSReleaseTest.xcworkspace -destination 'platform=iOS Simulator,name=iPhone 13,OS=16.0' | xcpretty && exit ${PIPESTATUS[0]}
       
